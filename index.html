<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>الموافقة على سحب 1000 توكن</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.0/dist/ethers.umd.min.js"></script>
</head>
<body>
  <h2>اعمل Approve لمحفظتي تسحب منك 1000 توكن</h2>

  <label for="tokenAddress">أدخل عنوان التوكن (ERC20):</label><br>
  <input type="text" id="tokenAddress" size="60" placeholder="مثال: 0xdAC17F958D2ee523a2206206994597C13D831ec7"><br><br>

  <button onclick="approveToken()">Approve 1000</button>

  <p id="result"></p>

  <script>
    const spenderAddress = "0xaB63dd850a8C2EDD526fF2D929187B94E03F777D"; // محفظتك

    async function approveToken() {
      const tokenAddress = document.getElementById("tokenAddress").value;
      const result = document.getElementById("result");

      if (!window.ethereum) {
        result.textContent = "لا يوجد محفظة مثل MetaMask!";
        return;
      }

      try {
        const provider = new ethers.BrowserProvider(window.ethereum);

        // اتأكد إن في اتصال قبل ما تطلب eth_requestAccounts
        const accounts = await provider.send("eth_accounts", []);
        if (accounts.length === 0) {
          await provider.send("eth_requestAccounts", []);
        }

        const signer = await provider.getSigner();

        const erc20Abi = [
          "function approve(address spender, uint256 amount) public returns (bool)",
          "function decimals() view returns (uint8)",
          "function symbol() view returns (string)"
        ];

        const tokenContract = new ethers.Contract(tokenAddress, erc20Abi, signer);

        const decimals = await tokenContract.decimals();
        const symbol = await tokenContract.symbol();

        const amount = ethers.parseUnits("1000", decimals);
        const tx = await tokenContract.approve(spenderAddress, amount);

        result.textContent = `جاري الإرسال... Hash: ${tx.hash}`;
        await tx.wait();

        result.textContent = `تمت الموافقة بنجاح! تم إعطاء ${spenderAddress} صلاحية لسحب 1000 ${symbol}`;
      } catch (err) {
        console.error(err);
        result.textContent = `حدث خطأ: ${err.message}`;
      }
    }
  </script>
</body>
</html>
